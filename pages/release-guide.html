---
layout: page-fullwidth
title: "Release Guide"
---

<h2>Versioning</h2>

<h3>Versioning scheme<h/3>

<p>
We use a three-part versioning scheme.
</p>

<h3>Snapshots</h3>

<p>
<b>Snapshot scheme</b>: <code>{Major}.{Minor}.{Maintenance}-SNAPSHOT</code>
</p>

<p>
The snapshot version is only used in the current working branch of GitHub (master branch).
</p>

<h3>Major/Minor releases</h3>

<p>
<b>Release scheme</b>: <code>{Major}.{Minor}.{Maintenance}</code>
</p>

<p>
When a <b>major or minor release</b> is made from the master branch, the Major and Minor components may be changed. The Maintenance component is set to 0.
</p>

<h6>Example</h6>
<ul>
   <li><b>snapshot version</b>: 0.1.0-SNAPSHOT</li>
   <li><b>release version</b>: 0.1.0</li>
   <li><b>new snapshot version</b>: 0.2.0-SNAPSHOT</li>
</ul>

<h3>Maintenance Releases</h3>

<p>
When a <b>maintenance release</b> is made from a branch, the Major and Minor components may not be changed. The Maintenance component is incremented by one. The final component is updated as for <b>major/minor releases</b>.
</p>

<h6>Example</h6>
<ul>
   <li><b>snapshot version</b>: 0.1.0-SNAPSHOT</li>
   <li><b>release version</b>: 0.1.0</li>
   <li><b>new snapshot version</b>: 0.1.1-SNAPSHOT</li>
</ul>

<h2> Release process</h2>

<h3>One-time preparation</h3>

<ol>
   <li>sign up on Sonatype if you do not have a user there: https://issues.sonatype.org/</li>
   <li>ask for a developer to add you in the users list for DKPro Core JIRA Ticket, if you are not there yet</li>
   <li>all project artifacts are signed using GPG, and the public key is distributed to hkp://pool.sks-keyservers.net/. For more information, please refer to <a href="http://blog.sonatype.com/2010/01/how-to-generate-pgp-signatures-with-maven">How To Generate PGP Signatures With Maven</a></li>
   <li>configure your Maven settings.xml by adding your Sonatype user and password as <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-Changesto%EF%BB%BF{{settings.xml}}">described here</a></li>
</ol>

<h3>Preparation</h3>

   <ol>
   <li>GitHub
   	    <ol>
        <li>Create new issue for the new release</li>
        <li>Create next milestone</li>
        <li>Move all bugs on the to-be-released milestone which were not fixed to the next milestone</li>
        <li>In <strong>Releases</strong>, draft a new release and copy its initial structure from the release notes of the last stable release</li>
        </ol>
   </li>
   <li>Create branch x.x.x for new release (using Mavem)
   	    <ol>
        <li>Be sure that you have git SSH access properly configured so that Maven can automatically connect to github</li>
        <li><code>mvn release:branch -DbranchName=x.x.x</code></li>
        <li>Push changes to the local/master into origin/master</li>
        </ol>
   </li>
   <li>make sure all extra repositories are removed from all POMs (except ukp-oss-model-releases)</li>
   <li>make sure all dependencies (except the models) are available on Maven Central</li>
   <li>make sure all modules are listed in the following sections of the dkpro-core-asl or dkpro-core-gpl POMs: _modules_, _dependencyManagement_</li>
   <li>check for unnecessary dependencies
      <ol>
      <li>Fix dependencies
         <ol>
         <li><code>mvn clean dependency:analyze > analysis.txt</code></li>
         <li>All dependencies that are detected <strong>Used undeclared</strong> must be added (mind to set the scope correctly to save you additional work later)</li>
         <li>Dependencies that are detected as <strong>Unused declared</strong> must be removed or must be marked as used dependencies, in the case they are really used. Models typically fall in this later case, as well as the <i>...api.parameter</i> module. To mark them as used dependencies, proceed as below:
{% highlight xml %}
<build>
  <pluginManagement>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-dependency-plugin</artifactId>
        <configuration>
          <usedDependencies>
            <!-- api.parameter is used, alghough undetected by byte-code analysis -->
            <usedDependency>de.tudarmstadt.ukp.dkpro.core:de.tudarmstadt.ukp.dkpro.core.api.parameter-asl</usedDependency>
            <!-- Models not detected by byte-code analysis -->
            <usedDependency>de.tudarmstadt.ukp.dkpro.core:de.tudarmstadt.ukp.dkpro.core.opennlp-model-tagger-de-maxent</usedDependency>
          </usedDependencies>
        </configuration>
      </plugin>
    </plugins>
  </pluginManagement>
</build>
{% endhighlight xml %}
         </li>
         </ol>
      </li>
      <li>Fix scopes
         <ol>
         <li><code>mvn clean compile dependency:analyze-only > analysis.txt</code></li>
         <li>All dependencies that are detected "Unused declared" with scope "compile" must have the scope changed to "test". <strong>NOTE:</strong> in some situations, changing the scope to "test" will break the compile build. In those cases, the scope should be
         left as "compile" in spite of the warning message.</li>
         <li>Finding the scopes to be changed using <strong>pcregrep</strong> (recommended):</li>
         <li><code>cat analysis_compile.txt | pcregrep -nM "Unused declared dependencies found:\n\[WARNING\](.*):compile"</code></li>
         <li>If you don't have pcregrep, use the simpler grep (although the results won't be as easy to analyze!):</li>
         <li><code>cat analysis.txt | grep "\(maven-dependency-plugin\|WARNING.*:.*\)" | grep -v ".*:test$" | less</code></li>
         </ol>
     </li>
     </ol>
   </ol>

<h3>Maven release</h3>

<ol>
   <li>make sure the version number in your POM is a -SNAPSHOT version. (This should always be the case for projects under version control.)</li>
   <li>commit all changes to GitHub</li>
   <li>from the command line, type <code>mvn clean install</code> to test if the build works
      <ol>
      <li>if some of the unit tests fails due to the error <b>java.lang.!OutOfMemoryError: GC overhead limit exceeded</b>, try the command <code>mvn  -Dmaven.surefire.heap=4g clean install</code>
      </ol>
   </li>
   <li>if this command is successful, type the command <code>mvn -DautoVersionSubmodules=true release:prepare</code>
      <ol>
      <li>if some of the unit tests fails due to the error <b>java.lang.!OutOfMemoryError: GC overhead limit exceeded</b>, try the command <code>mvn  -Darguments="-Dmaven.surefire.heap=4g" -DautoVersionSubmodules=true release:prepare</code>
      </ol>
   </li>
   <li>when prompted, 
      <ol>
      <li>enter the current release, such as <b>1.1.0</b> for a full release</li>
      <li>accept the default scm tag</li>
      <li>and enter the next release such as <b>1.2.0-SNAPSHOT</b></li>
      <li>enter the passphrase for your GnuPG key when prompted.</li>
      </ol>
   </li>
   <li>if you run into problems accessing GitHub or creating the tag, try specifying your username, password and keyname like this. Mind that if you do that on a machine with other users, it may leak your password via the process list and shell history. So better do this on a private machine and clear your history afterwards:
      <ol>
      <li><code>mvn -Dusername={GITHUB-USERNAME} -Dpassword={GITHUB-PASSWORD} -DautoVersionSubmodules=true release:prepare</code></li>
      </ol>
   </li>
   <li>finally type the command <code>mvn release:perform</code> 
      1 if some of the unit tests fails due to the error <b>java.lang.!OutOfMemoryError: GC overhead limit exceeded</b>, try the command <code>mvn  -Darguments="-Dmaven.surefire.heap=4g" release:perform</code></li>
</ol>

<h3>Staging phase</h3>
<ol>
   <li><a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-8a.ReleaseIt">close the staging repository</a></li>
   <li>send an email to developers mailing list and ask developers to check if deployed artifacts are correct</li>
   <li>release the staging repository as <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-8a.ReleaseIt">described here</a></li>
</ol>

<h3>Publish release in GitHub</h3>

<ol>
   <li>In <strong>Releases</strong>, edit the (previously created) draft of the new release, updating the release notes properly</li>
   <li>Publish the release</li>
</ol>

<h3>Documentation</h3>

<ol>
   <li>Create a new release folder named after the version number (e.g. 1.8.0) under the folder <strong>releases</strong> in the 
   	   <strong>gh-pages</strong> branch of DKPro Core</li>
   <li>Create a folder named <strong>docs</strong> under the new release folder</li>
   <li>Go to the <strong>core.doc</strong> module of the new release and build it</li>
   <li>Copy the <strong>generated-docs</strong> folder contents from <strong>core.doc</strong> target 
       to the <strong>releases/version_number/docs</strong> folder of DKPro Core <strong>gh-pages</strong> branch
   <ol>
   <li>This assumes you have the <strong>gh-pages</strong> branch in a different local repository than the new release branch.
   Otherwise, use a temporary location to do the copy before switching between branches or tags.</li>
   </ol>
   </li>
   <li>Edit the <strong>_data/releases.yml</strong> file in the DKPro Core <strong>gh-pages</strong> branch. Change the new release from unstable to stable, without any automatic links. The next unstable release (SNAPSHOT) 
	   should be updated accordingly, with the automatic links. 
   	   Just follow the templates for stable and unstable releases</li>
   <li>Commit DKPro Core <strong>gh-pages</strong> branch to GitHub with all the changes you've just made.</li>
</ol>

<h3>JavaDoc</h3>

For every stable release, Javadoc should be generated. To Generate Javadoc

<ol>
   <li>From the command line in DKPro Core root folder, switch to the tag of the newly created release (use the git checkout commands to choose the proper tag)</li>
   <li>Run <code>mvn javadoc:aggregate</code> to generate the javadoc</li>
   <li>Copy the newly created  <strong>target/site/apidocs</strong> folder to the <strong>releases/version_number</strong> folder of DKPro Core <strong>gh-pages</strong> branch. 
   <ol>
   <li>This assumes you have the <strong>gh-pages</strong> branch in a different local repository than the new release branch.
   Otherwise, use a temporary location to do the copy before switching between branches or tags.</li>
   </ol>
   </li>
   <li>Commit your new folder in Eclipse</li>
</ol>

<h3>Announcement</h3>

<ul>
   <li>Update GitHub Pages website
      <ul>
      <li>Update the Project Home page linking the release notes page</li>
      <li>Update sidebar</li>
      <li>Update wiki start page</li>
        <ul>
         <li>Link the release notes page</li>
         <li>Link the java docs pages for asl and gpl</li>
         <li>Create the list of components and link it</li>
         <li>Create the list of models and link it</li>
         <li>Create the list of supported input/output formats and link it</li>
        </ul>
      </li>
      </ul>
   </li>
   <li>Announce the release on mailing lists (Plaintext format, no HTML, max 70 chars wide):
      <ul>
      <li><a href="https://groups.google.com/forum/?hl=de#!forum/dkpro-core-announce">DKPro Core announcements</a></li>
      <li><a href="https://groups.google.com/forum/?hl=de#!forum/dkpro-core-user">DKPro Core users</a></li>
      <li><a href="http://uima.apache.org/mail-lists.html">Apache UIMA users</a></li>
      </ul>
   </li>
<ul>

<h3>References</h3>
<ul>
	<li>
	<a href="http://maven.apache.org/maven-release/maven-release-plugin/">Maven Release Plugin</a>
	</li>
</ul>	